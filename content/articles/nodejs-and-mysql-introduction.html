---
title: "NodeJS and MySQL introduction"
author: Dan
date: 2010-09-22
---

<strong>STEP 1</strong>: I started at <a href="http://github.com/felixge/node-mysql">http://github.com/felixge/node-mysql</a> To install: <pre><code data-language="bash">npm install mysql</code></pre> Which installed it into the guts of node (\usr\local\lib\node\.npm\mysql\0.5.0\package\lib\mysql) It installed mysql and gently. <strong>STEP 2</strong>: Create a new test app (app.js) with the following in it: <pre><code data-language="js"> var Client = require('mysql').Client; var client = new Client(); client.user = 'myusername'; client.password = 'mypassword'; console.log("connecting..."); client.connect(function(err, results) { if (err) { console.log("ERROR: " + err.message); throw err; } console.log("connected."); clientConnected(client); }); clientConnected = function(client) { } </code></pre> Run this (node app.js), and see if you get a "connected" message or an "error" message. If you got an error, it should be because you either don't have MySQL installed on this machine or your username/password is wrong. <strong>STEP 3</strong>: Create a database to test with. Edit your new app.js file, and add the following: <pre><code data-language="js"> clientConnected = function(client) { client.query('CREATE DATABASE test', function(err, results) { if (err && err.number != Client.ERROR_DB_CREATE_EXISTS) { console.log("ERROR: " + err.message); throw err; } console.log("database created OR already exists."); dbCreated(client); }); }; dbCreated = function(client) { }; </code></pre> <strong>STEP 4</strong>: Just select this newly created database to work with. Note: You should notice that each step has a callback function that gets called when the requested database operation completes (or errors). I have called a new function within each of these callback functions to reduce the nesting, and hopefully make it slightly easier to read and understand. <pre><code data-language="js"> dbCreated = function(client) { client.query('USE test', function(err, results) { if (err) { console.log("ERROR: " + err.message); throw err; } useOk(client); }); }; useOk = function(client) { }; </code></pre> <strong>STEP 5</strong>: Time to create a table. We'll create a rather standard MySQL table. It will contain an auto-incrementing id field, a couple text fields, and a date field. We'll make the id field a primary key. Hint: If you ever want to see what one of these callback functions get passed to it, try the following super-awesome line: (It displays the contents of a variable -- in this case all arguments passed in) <pre><code data-language="js"> console.dir(arguments); </code></pre> Now, add the following to your growing app.js file: <pre><code data-language="js"> useOk = function(client) { client.query( 'CREATE TABLE table1'+ '(id INT(11) AUTO_INCREMENT, '+ 'title VARCHAR(255), '+ 'text TEXT, '+ 'created DATETIME, '+ 'PRIMARY KEY (id));', function(err, results) { if (err && err.number != Client.ERROR_TABLE_EXISTS_ERROR) { console.log("ERROR: " + err.message); throw err; } console.log("table ready"); tableReady(client); } ); }; tableReady = function(client) { }; </code></pre> <strong>STEP 6</strong>: Let's insert a row of data into our table. We'll use the hint from the previous step to see what the results look like after inserting into the table. <pre><code data-language="js">tableReady = function(client) { client.query( 'INSERT INTO table1'+ ' SET title = ?'+ ', text = ?'+ ', created = ?', ['super cool', 'this is a nice text', '2010-08-16 10:00:23'], function(err, results) { if (err) { console.log("ERROR: " + err.message); throw err; } console.dir(results); console.log("Inserted "+results.affectedRows+" row."); console.log("The unique id was " + results.insertId); tableHasData(client); } ); }; tableHasData = function(client) { }; </code></pre> <strong>STEP 7</strong>: Now, we can finally query the database and get back a result set. We will select everything out of our table. If you are following along with this example as you go, you should get a few rows of data (since each time you run this app, it will insert a new row of data). Hint: You can get the meta data associated with the columns (I've commented out those two lines below). If you want to see the meta data, un-comment out the lines and run the app again. <pre><code data-language="js"> tableHasData = function(client) { client.query( 'SELECT * FROM table1', function selectCb(err, results, fields) { if (err) { console.log("ERROR: " + err.message); throw err; } console.log("Got "+results.length+" Rows:"); console.log(results); //console.log("The meta data about the columns:"); //console.log(fields); client.end(); }); }; </code></pre> That is the end. You should now have a simple app that connects to MySQL, creates a database, creates a table, inserts a row, and queries the table. Good luck.